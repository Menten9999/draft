<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ステータスメッセージ用のスタイル */
        #status-message {
            margin-top: 15px;
            font-size: 1.1em;
            font-weight: bold;
            color: #d90429; /* 赤色 */
            height: 25px;
        }
    </style>
</head>
<body>
<main class="main">
    <h1 class="tytle" id="round-title">第一巡選択希望選手選択画面</h1>
    <label for="pet-select">選択希望選手</label>
    <form name="jstest">
        <select name="pets" id="pet-select">
            <option value="">--選手を選択してください--</option>
            <option value="仙田">仙田</option>
            <option value="新井">新井</option>
            <option value="上坂">上坂</option>
            <option value="田中">田中</option>
            <option value="鵜飼">鵜飼</option>
            <option value="布目">布目</option>
            <option value="冨高">冨高</option>
            <option value="大寺">大寺</option>
        </select>
    </form>
    <input type="button" value="確定" onclick="submitSelection()"/>
    <div class="selected">選択選手： <span id="BtnTest"></span></div>
    <div id="status-message"></div>
</main>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase-config.js"></script>

<script>
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const teamId = 'team2';

    const roundRef = database.ref('round');
    const selectionRef = database.ref('currentSelections/' + teamId);
    // ★★★ チームのステータスを監視するRefを追加 ★★★
    const statusRef = database.ref('teamStatus/' + teamId);

    // 巡目の変更を監視 (変更なし)
    roundRef.on('value', (snapshot) => {
        const round = snapshot.val() || 1;
        document.getElementById('round-title').textContent = `第${round}巡選択希望選手選択画面`;
    });

    // 選択状況の変更を監視 (変更なし)
    selectionRef.on('value', (snapshot) => {
        const selectedPlayer = snapshot.val();
        document.getElementById("BtnTest").textContent = selectedPlayer || "未選択";
        document.jstest.pets.value = selectedPlayer || "";
    });

    // ★★★ チームステータスの変更を監視する処理を追加 ★★★
    statusRef.on('value', (snapshot) => {
        const message = snapshot.val();
        const messageEl = document.getElementById('status-message');
        if (message) {
            messageEl.textContent = message;
            // 5秒後にメッセージを消去し、DBからも削除
            setTimeout(() => {
                messageEl.textContent = '';
                statusRef.remove(); 
            }, 5000);
        }
    });

    // 選択を送信する関数 (変更なし)
    function submitSelection() {
        const selectedPlayer = document.jstest.pets.value;
        if (selectedPlayer) {
            selectionRef.set(selectedPlayer)
                .then(() => {
                    alert('「' + selectedPlayer + '」選手を指名しました。');
                });
        } else {
            selectionRef.remove();
        }
    }
</script>
</body>
</html>