<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<main class="main">
    <h1 class="tytle" id="round-title">第一巡選択希望選手選択画面</h1>
    <label for="pet-select">選択希望選手</label>
    <form name="jstest">
        <select name="pets" id="pet-select">
            <option value="">--選手を選択してください--</option>
            <option value="仙田">仙田</option>
            <option value="新井">新井</option>
            <option value="上坂">上坂</option>
            <option value="田中">田中</option>
            <option value="鵜飼">鵜飼</option>
            <option value="布目">布目</option>
            <option value="冨高">冨高</option>
            <option value="大寺">大寺</option>
        </select>
    </form>
    <input type="button" value="確定" onclick="submitSelection()"/>
    <div class="selected">選択選手： <span id="BtnTest"></span></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script src="firebase-config.js"></script>
    <script>


        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const teamId = 'team1';

        const roundRef = database.ref('round');
        const selectionRef = database.ref('currentSelections/' + teamId);

        // 巡目(round)の変更を監視
        roundRef.on('value', (snapshot) => {
            const round = snapshot.val() || 1;
            // h1タグのタイトルを現在の巡目に更新
            document.getElementById('round-title').textContent = `第${round}巡選択希望選手選択画面`;
        });

        // このチームの選択状況(selection)の変更を監視
        selectionRef.on('value', (snapshot) => {
            const selectedPlayer = snapshot.val();
            // 選択されていれば表示、されていなければクリア
            document.getElementById("BtnTest").textContent = selectedPlayer || "未選択";
            document.jstest.pets.value = selectedPlayer || "";
        });

        // 「確定」ボタンを押したときの処理
        function submitSelection() {
            const selectedPlayer = document.jstest.pets.value;
            if (selectedPlayer) {
                // データベースに選択選手を書き込む
                selectionRef.set(selectedPlayer)
                    .then(() => {
                        alert('「' + selectedPlayer + '」選手を指名しました。');
                    });
            } else {
                // 未選択の場合はデータベースから削除
                selectionRef.remove();
            }
        }
    </script>
</main>
</body>
</html>