<!DOCTYPE html>
<head>
		<meta charset="UTF-8">
		<meta name="robots" content="noindex">
		<link rel="stylesheet" href="style.css">
</head>
<body>
<main class="main">
    <h1 class="tytle" id="round-title">選択希望選手選択画面</h1>
    <label for="pet-select">選択希望選手</label>
    <form name="jstest">
        <select name="pets" id="pet-select">
            <option value="">--選手を選択してください--</option>
            <option value="仙田">仙田</option>
            <option value="新井">新井</option>
            <option value="上坂">上坂</option>
            <option value="田中">田中</option>
            <option value="鵜飼">鵜飼</option>
            <option value="布目">布目</option>
            <option value="冨高">冨高</option>
            <option value="大寺">大寺</option>
        </select>
    </form>
    <input type="button" value="確定" onclick="JsBtn()"/>
    <div class="selected">選択選手： <span id="BtnTest"></span></div>
    
    <script>
        const teamId = 'team1';
        const currentSelectionKey = teamId + '_currentSelection';
        const roundKey = 'draftRound';

        // ページの表示を更新するための関数
        function updatePageDisplay() {
            // 1. 巡目をlocalStorageから取得してh1タグを更新
            const round = localStorage.getItem(roundKey) || 1;
            document.getElementById('round-title').textContent = `第${round}巡選択希望選手選択画面`;

            // 2. 選択選手をlocalStorageから取得して表示を更新
            const savedSelection = localStorage.getItem(currentSelectionKey);
            if (savedSelection) {
                document.getElementById("BtnTest").textContent = savedSelection;
                document.jstest.pets.value = savedSelection;
            } else {
                // 保存されている選手がいない場合（次巡に進んだ場合など）は表示をクリア
                document.getElementById("BtnTest").textContent = "選択されていません";
                document.jstest.pets.value = "";
            }
        }

        // 「確定」ボタンが押されたときの処理
        function JsBtn(){
            const selectedValue = document.jstest.pets.value;

            if(selectedValue) {
                // 選択した選手をlocalStorageに保存
                localStorage.setItem(currentSelectionKey, selectedValue);
                document.getElementById("BtnTest").textContent = selectedValue;
                alert('「' + selectedValue + '」選手を指名しました。');
            } else {
                // 未選択の場合はlocalStorageから削除
                localStorage.removeItem(currentSelectionKey);
                document.getElementById("BtnTest").textContent = "選択されていません";
            }
        }

        // ページが最初に読み込まれた時に、表示を整える
        window.onload = function() {
            updatePageDisplay();
        };

        // ★★★重要★★★
        // 他のタブでlocalStorageが変更されたのを検知して、表示をリアルタイムに更新
        window.addEventListener('storage', function(event) {
            // 管理者ページで巡目が進んだり、データがクリアされた場合にこのページも更新する
            if (event.key === roundKey || event.key === currentSelectionKey) {
                updatePageDisplay();
            }
        });
    </script>
</main>
</body>
</html>